# Desired Features and Functional Improvements

This document lists desired functional improvements for the NeedForHeat GearUp app. These are lower priority than the technical debt items listed in the main [README.md](README.md) but are important for enhancing user experience and functionality. Items are grouped by functionality for clarity.

## To-Do (Functional Improvements)

### Authentication
- **Social Media Login with OpenID Connect**:
  - Allow users to log in using social media IDs (e.g., Google, Microsoft, Apple, Facebook, Twitter, SurfConext) via OpenID Connect with pairwise subject identifiers ([OpenID Connect Spec](https://openid.net/specs/openid-connect-core-1_0.html#SubjectIDTypes)). Store only the identity provider and pairwise sub on the server to maintain privacy. This optional feature enables seamless login across devices after initial use. 
    > [!NOTE]
    > This does not replace the account-less dynamic link login; it allows users to reconnect to their account on a new device (e.g., after loss, theft, or upgrade) without campaign staff assistance.


- **Handle Re-Clicking Activation Links**:
  - Prevent errors when clicking an already-used account activation link if the app is activated. Ensure the app recognizes prior activation and skips redundant attempts.

### Device Provisioning
- **Support Test and Production Account Activation Tokens**:
  - Enable the app to consume both test and production account activation tokens from dynamic links (or their future replacement). Allow configuration of the destination server (test or production) via the link to simplify device provisioning and eliminate the need for separate test/production firmware.
- **Send UseProductionServer Flag via Unified Provisioning**:
  - Extend Unified Provisioning to send a boolean `UseProductionServer` flag to the device, allowing the app to configure whether data is sent to the test or production server. This should be set via dynamic links (or their future replacement) to streamline provisioning.
- **Unified Provisioning via SoftAP (WiFi)**:
  - Add support for SoftAP (WiFi) in the app for Unified Provisioning to enhance device provisioning options.
- **BASE45-Encoded QR-Code Payloads for Unified Provisioning**:
  - Implement BASE45-encoded alphanumeric deeplinks in device provisioning QR-codes (e.g., `NFH://UJCLQE7W5812YF6KZWNTT8VCN10QTYG5`) for Espressif Unified Provisioning. Include:
    - First 32 bits of SHA256 hash of `device_type.name`.
    - Last 24 bits of Bluetooth MAC address (last 3 octets).
    - Random `pop` value generated by ESP32’s true random number generator.
  - Register the `NFH` scheme in the app to handle these deeplinks, enabling automatic redirection when scanned by the OS. Use alphanumeric QR encoding to:
    - Reduce payload size for smaller QR codes (e.g., version 2/3), suitable for e-ink displays or challenging scanning conditions.
    - Support higher error correction levels for reliability.
    - Increase `pop` entropy (e.g., up to 147 bits vs. current 30 bits) for enhanced security.
  - Reduces name collision risks (e.g., 1 in 100,000 for 256 device types) compared to current format. Corresponding changes are required in the [needforheat-generic-firmware](https://github.com/energietransitie/needforheat-generic-firmware) to generate and handle these QR-code payloads, including BASE45 encoding and decoding logic ([BASE45 RFC](https://datatracker.ietf.org/doc/rfc9285/)).

### Static Content
- **Redesign Static Content for Relative Links**:
  - Restructure static content (e.g., manuals, FAQs) to use language codes higher in the content tree, ensuring relative links work seamlessly. Retain filenames during content generation (e.g., convert `_.md` to `_.html`) and deploy by copying files without filename processing. The server should select the content branch based on the `Accept-Language` header.
- **Dynamic FAQ Links from /account/activate Endpoint**:
  - Update the app’s info screen to use FAQ, ‘about the app’, and privacy policy links from the `/account/activate` endpoint response. Provide default links (current ones) if the app is not activated. Ensure links are easily changeable.
- **Remove Duplicated Headers in Static Content**:
  - Eliminate duplicated headers in static content (manuals, privacy policy, FAQs) to improve clarity and consistency.

### Energy Queries
- **EnergyQueries Functionality Improvements**:
  - **Initial Map Centering and Zooming**:
    - Center the map at the user’s GPS location and zoom to street level when initiating an energy query.
    - Prompt for GPS permission if not granted; if denied, do not auto-center unless explicitly requested.
  - **Address Editing**:
    - Fix the ‘Locate Me’ button functionality when editing an address.
  - **Automatic Centering on Address Change**:
    - Center the map immediately upon a valid address change (e.g., “De Bosrand 90, 7207 MH Zutphen, Netherlands”).
  - **Address Stability**:
    - Ensure the address remains stable during map zooming; investigate and fix any related issues.

### UI/UX Improvements
- **Improve Energy Monitoring Feedback/Graphs**:
  - Enhance readability of energy monitoring graphs based on user feedback (TBD from pre-test). Consider inspiration from platforms like [emonCMS](https://emoncms.org/) for design improvements.
- **Localize expo/app.json**:
  - Localize the `app.json` file in `needforheat-gearup-app\apps\expo\` to support multi-language configurations.